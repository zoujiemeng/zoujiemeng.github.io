---
layout: post
title: "jsoncpp的使用教程"
tagline: "C++"
description: "jsoncpp的使用教程"
category: C++
tags: [C++,jsoncpp]
last_updated: 2017-03-30
---
jsoncpp是json数据格式的编码解码器，提供reader和writer来进行解码和编码。下面就简要的介绍[jsoncpp](https://github.com/open-source-parsers/jsoncpp)的使用方法。
##jsoncpp主要类的介绍
###Reader类
该库中的Reader类用来将字串或者流载入解析器。可以用Reader里面的解析方法来解码Json字串为C++认识的数据。可以用 Json::Reader来声明一个Reader实例。Reader中最常用的就是一个parse方法，该方法用来将载入的json字串解析为C++格式的数据。
###Value类
该库中的核心类，用于存储各样格式的数据，可以包括int,double,short,char *,string,bool,object,array等几乎所有格式的数据。该库的编码和解码的核心功能都是用Value类实现的。值得注意的是，Reader类对象的parse方法需要传入一个Value类别的引用值，该value对象用来存储Json数据的根值，并且可以用这个根值来存取其他的所有值。
###Writer
该库的一个虚类，没有真正的实现encode的功能。需要重载里头的方法来实现真正的encode功能。
###FastWriter
该库中真正实现encode功能的类，用来实现将Value编码称为Json串。
##实例应用
###实例json文件内容：
> {"address":[
>     {"name":"eliteYang", "email":"elite_yang@163.com"},
>     {"name":"AAA", "email":"aaa@163.com"},
>     {"name":"BBB", "email":"bbb@163.com"}
> ]}
###解析并读入数据
    #include <fstream>
    #include <string>
    #include <iostream>
    #include <json/json.h>
    using namespace std;
    
    int main()
    {
    	ifstream ifs;
    	ifs.open("test.json");
    
    	Json::Reader reader;
    	Json::Value root;
    	if (!reader.parse(ifs, root, false))
    	{ return -1; }
    
    	Json::Value add_value = root["address"];
    	for (int i = 0; i < add_value.size(); ++i)
    	{
    		Json::Value temp_value = add_value[i];
    		string strName = temp_value["name"].asString();
    		string strMail = temp_value["email"].asString();
    		cout << "name: " << strName << " email: " << strMail << endl;
    
    		// use value array[index]
    		//Json::Value temp_value = add_value[i];
    		//std::string strName = add_value[i]["name"].asString();
    		//std::string strMail = add_value[i]["email"].asString();
    		//std::cout << "name: " << strName << " email: " << strMail << std::endl;
    	}
    
    	system("Pause");
    
    	return 0;
    }
###解析Json文件并实现增删改功能
    #include <fstream>
    #include <string>
    #include <iostream>
    #include <json/json.h>
    using namespace std;
    
    int main()
    {
    	ifstream ifs;
    	ifs.open("test.json");
    
    	Json::Reader reader;
    	Json::Value root;
    	if (!reader.parse(ifs, root, false))
    	{ return -1; }
    
    	//增加元素
    	Json::Value &add_value = root["address"];
    	Json::Value append_value;
    	append_value["name"] = "append";
    	append_value["email"] = "append@163.com";
    	add_value.append(append_value);
    
    	//修改元素
    	Json::Value &change_value = add_value[1];
    	change_value["name"] = Json::Value("zoujiemeng");
    	change_value["email"] = Json::Value("zzz-oo-u@163.com");
    
    	//删除元素
    	add_value[2].removeMember("name");
    
    
    	for (int i = 0; i < add_value.size(); ++i)
    	{
    		Json::Value temp_value = add_value[i];
    		string strName = temp_value["name"].asString();
    		string strMail = temp_value["email"].asString();
    		cout << "name: " << strName << " email: " << strMail << endl;
    
    	}
    	Json::FastWriter writer;
    	//未格式化的Json
    	string json_append_file = writer.write(root);
    	//格式化之后的json,有回车换行符
    	string strOut = root.toStyledString();
    	ofstream ofs;
    	ofs.open("test_append.json");
    	ofs << json_append_file;//未格式化
    	ofs << strOut;//格式化
    	system("Pause");
    
    	return 0;
    }
